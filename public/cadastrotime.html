<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="./fotos/csgo-icon-42843-Windows.ico">
    <style>
        body {
            background: url('./fotos/ak47.png')no-repeat center center fixed;
            background-size: cover;
            overflow: scroll;
        }
    </style>
    <title>Cadastro de Time</title>
</head>

<body onload="tudo()">
    <div class="menutopo">
        <div class="container">

            <img src="./fotos/logo.png" class="foto_logo"></img>
        </div>
        <span class="textolink">
            <a class="acor" href="index.html">Home</a>
            <a href="tirar-time.html">Tirar Times</a>
            <a href="times.html">Times</a>
            <a href="avalie.html">Avalie</a>
            <a href="jogadores.html">Jogadores</a>
            <a href="cadastro.html" style="float: right;">Cadastrar Jogador</a>
        </span>
    </div>

    <div class="login-page" id="tela_cadastro">
        <div class="formulario">
            <div class="form">
                <h2>Cadastro De Time</h2>
                <br>
                <h4>(Lembrando que Todos os Jogadores Devem Estar Cadastrados no Site)</h4><br><br>
                <form class="register-form" id="form_cadastro">
                    <p>Nome do Time</p>
                    <input class="inputt" name="nome" type="text" placeholder="Nome Do Time">
                    <br>
                    <p>ID Steam do Responsável</p>
                    <input class="inputt" name="idsteam" type="text" placeholder="32432670">
                    <br>
                    <p>Token do Time</p>
                    <input class="inputt" name="token_time" type="text" placeholder="time@123Kk#">
                    <br>
                    <p>Token Jogador 1</p>
                    <input class="inputt" name="token1" type="text" placeholder="nome@123Kk#">
                    <br>
                    <p>Token Jogador 2<br></a></p>
                    <input class="inputt" name="token2" type="text" placeholder="nome@123Kk#">
                    <br>
                    <p>Token Jogador 3<br></a></p>
                    <input class="inputt" name="token3" type="text" placeholder="nome@123Kk#">
                    <br>
                    <p>Token Jogador 4<br></a></p>
                    <input class="inputt" name="token4" type="text" placeholder="nome@123Kk#">
                    <br>
                    <p>Token Jogador 5<br></a></p>
                    <input class="inputt" name="token5" type="text" placeholder="nome@123Kk#">
                    <br>
                </form>
                <button class="btnin" onclick="cadastrar()">Cadastrar</button>
            </div>
        </div>
        <div id="div_aguardar" class="loading-div">

        </div>

        <div id="div_erros_login">

        </div>
    </div>
</body>

</html>
<script>
    var ax_nome = '';
    var formulario = '';

    var nome = '';
    var idsteam = '';
    var token1 = '';
    var token2 = '';
    var token3 = '';
    var token4 = '';
    var token5 = '';
    var token_time = '';
    var token_usuarios = [];
    var token_times = [];
    var jogador_fkequipe = [];
    var nome_equipes = [];

    function cadastrar() {
        formulario = new URLSearchParams(new FormData(document.getElementById("form_cadastro")));

        nome = formulario.get("nome");
        idsteam = formulario.get("idsteam");
        token1 = formulario.get("token1");
        token2 = formulario.get("token2");
        token3 = formulario.get("token3");
        token4 = formulario.get("token4");
        token5 = formulario.get("token5");
        token_time = formulario.get("token_time");


        validar();



    }







    function validar() {
        if (nome == "" || idsteam == "" || token1 == "" || token2 == "" || token3 == "" || token4 == "" || token5 ==
            "" || token_time == "") {

            window.alert("Preencha todos os campos para prosseguir!");
            if (nome == "") {
                alert('nome está em branco');
            }
            if (idsteam == "") {
                alert('Id do responsável está em branco');
            }
            if (token5 == 0 || token5 == '') {
                alert('token5 está em incorreta');
            }
            if (token1 == 0 || token1 == '') {
                alert('nick está em branco');
            }
            if (token4 == 0 || token4 == '') {
                alert('token4 está em branco');
            }

            if (token3 == 0 || token3 == '') {
                alert('token3 está em branco');
            }
            if (token2 == 0 || token2 == '') {
                alert('token2 está em branco');
            }
            if (token_time == 0 || token_time == '') {
                alert('token2 está em branco');
            }

            return false;
        }

        if (token_usuarios.indexOf(token1) == -1) {
            alert('Token do jogador 1 não existe!!');
            return false;
        }
        if (token_usuarios.indexOf(token2) == -1) {
            alert('Token do jogador 2 não existe!!');
            return false;
        }
        if (token_usuarios.indexOf(token3) == -1) {
            alert('Token do jogador 3 não existe!!');
            return false;
        }
        if (token_usuarios.indexOf(token4) == -1) {
            alert('Token do jogador 4 não existe!!');
            return false;
        }
        if (token_usuarios.indexOf(token5) == -1) {
            alert('Token do jogador 5 não existe!!');
            return false;
        }
        let len = token_usuarios.length;
        for (let m = 0; m <= len; m++) {

            if (token_times[m] == token_time) {
                alert('Esse token de equipe já existe!!');
                return false;
            }
            if (nome_equipes[m] == nome) {
                alert('Esse nome de equipe já existe!!');
                return false;
            }
            if (token1 == token_usuarios[m] && jogador_fkequipe[m] != null) {
                alert('Jogador 1 ja possue uma equipe!!');
                return false;
            }
            if (token2 == token_usuarios[m] && jogador_fkequipe[m] != null) {
                alert('Jogador 2 ja possue uma equipe!!');
                return false;
            }
            if (token3 == token_usuarios[m] && jogador_fkequipe[m] != null) {
                alert('Jogador 3 ja possue uma equipe!!');
                return false;
            }
            if (token4 == token_usuarios[m] && jogador_fkequipe[m] != null) {
                alert('Jogador 4 ja possue uma equipe!!');
                return false;
            }
            if (token5 == token_usuarios[m] && jogador_fkequipe[m] != null) {
                alert('Jogador 5 ja possue uma equipe!!');
                return false;
            }




        }
        inserir();
    }

    function tudo() {
        fetch("/usuarios/listar", {
            method: "GET",
        }).then(function (resposta) {


            resposta.json().then(function (data) {
                let len = data.length;

                for (let i = 0; i < len; i++) {
                    let arquivo = data[i];
                    token_usuarios.push(arquivo.token);
                    token_times.push(arquivo.idEquipe);
                    jogador_fkequipe.push(arquivo.fkEquipe);
                    nome_equipes.push(arquivo.nomeeqp);


                }









            });
        }).catch(function (error) {
            console.error(`ERROR`, error);
        });
    }


    function inserir_jogadores() {
        setTimeout(insert_jogador1(), 5000);
        setTimeout(insert_jogador2(), 5000);
        setTimeout(insert_jogador3(), 5000);
        setTimeout(insert_jogador4(), 5000);
        setTimeout(insert_jogador5(), 5000);
    }








    function insert_jogador1() {
        fetch("/usuarios/insertj1", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {


            if (resposta.ok) {
                console.log("Cadastro do jogador 1 realizado com sucesso!");
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro do jogador 1!");
            }
        }).catch(function (resposta) {});

    }

    function insert_jogador2() {
        fetch("/usuarios/insertj2", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                console.log("Cadastro do jogador 2 realizado com sucesso!");
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro do jogador 2!");
            }
        }).catch(function (resposta) {});

    }

    function insert_jogador3() {
        fetch("/usuarios/insertj3", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                console.log("Cadastro do jogador 3 realizado com sucesso!");
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {});

    }

    function insert_jogador4() {
        fetch("/usuarios/insertj4", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                console.log("Cadastro do jogador 4 realizado com sucesso!");
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro do jogador 4!");
            }
        }).catch(function (resposta) {});

    }

    function insert_jogador5() {
        fetch("/usuarios/insertj5", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                console.log("Cadastro do jogador 5 realizado com sucesso!");
                window.location = "times.html";
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro do jogador 5!");
            }
        }).catch(function (resposta) {});

    }

    function inserir() {
        fetch("/usuarios/cadastrar2", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {

            if (resposta.ok) {
                inserir_jogadores();
                alert("Cadastro de time realizado com sucesso!");
                window.location = "times.html";

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {});
    }
</script>